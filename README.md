# B2C 生鲜类项目总结

> 为了加深对 Django 框架的使用，我创建了一个 B2C 类的购物商城网站「天天生鲜」。

</br>

该网站包括 4 个模块：用户模块、商品模块、购物车模块、订单模块。

![](https://raw.githubusercontent.com/Senglin75/ImagesOfBlog/master/img/%E5%A4%A9%E5%A4%A9%E7%94%9F%E9%B2%9C.png)

其中各个模块的详细总结见下链接：

* [用户模块]()

* [商品模块]()

* [购物车模块]()

* [订单模块]()

  </br>

使用的技术栈有：

* <b>前端：</b>HTML、CSS、JavaScript、jQuery、Ajax

* <b>前端框架：</b>Django

* <b>数据库：</b>MySQL、Redis

* <b>异步任务队列、文件分布式存储：</b>FastDFS、Celery

* <b>全文检索（中文）：</b>.haystack、whoosh、jieba

* <b>部署：</b>Nginx、uWSGI

  </br>

  ## 小结

通过本次网站的搭建，使得我原先不是很熟悉的 Django 框架有了新的理解，如网站用户的验证是用的 Django 默认的认证系统「AbstractUser」，修改了 Django 默认的文件存储方式为 FastDFS。

整个数据库从设计到实现，使得我对三范式的理解又有了新的提升。其中订单页面的处理事务并发的「悲/乐观锁」又为我打开了 MySQL 新的领域，悲观锁很像线程锁，通过加锁的方式强制对事务进行排序，解决了并发情况下多个事务之间的冲突问题，但由于加锁、解锁消耗了 MySQL 的内存，降低了效率，也提高了事务之间的等待时间。但是乐观锁的出现，则解决了锁的问题，乐观锁通过为事务设计版本号，在高并发情况下，多个事务同时对数据库的某一列数据进行操作时，通过比较前后版本号的不同，来区别当前事务所读数据是否被修改，如若修改则重复几次（最多 3 次）操作，直至当前事务的前后版本号一致，说明当前事务的数据没有被其他事务更改。悲观锁、乐观锁的优缺点很明显：当写入操作频发时，也就是冲突较多时，使用悲观锁，当读取操作频繁时，也就是冲突较少时，使用乐观锁。



前后端的数据交互设计，让我明白了前后端在数据交互上要有着一个意识：

</br>

<li><b>使用什么方式传递数据?</b></li>

<li><b>传递什么数据?</b></li>

</br>

也使得我学会了 Ajax，懂得了 Ajax 默认开启异步执行，也就意味着在 js 代码里，Ajax 的执行不会等待回调函数的执行完毕，而是直接往下执行代码，这使得在有些场景下需要我们手动关闭 Ajax 的的异步执行，换成同步执行。



网页优化方面让我懂得了一个网站要尽可能的减少对数据库的操作，尽量使用缓存。比如首页，由于首页是一个不会经常发生变化的页面，因此我们可以使用一个静态文件来代替首页，使得高并发时用户访问首页的速度得到提升，并且利用缓存，当用户跳转回首页时，读取缓存里的内容，提高速度，降低了数据库压力，也在一定程度上防止了恶意 DOS 攻击。前端页面 js 部分使用链式，且尽可能少定义变量，减少网页在预加载时对这些变量进行加载，提高网页运行速度。



网站订单部分学习了「支付宝支付」的相关知识，使用了支付宝的「沙箱环境」，调用了支付宝的订单接口，并懂得了原来 PC 端「电脑支付」是通过将用户的支付请求转交给支付宝，并由支付宝来返回订单支付状态，且支付状态的告知有两种方式:

</br>

<li><b>同步</b></li>

<li><b>异步</b></li>

</br>

同步指的是当你向支付宝提交订单时，支付宝同时返回一个订单交易状态，异步指的是过一会儿订单交易完成，支付宝返回一个订单交易状态，两者以异步为准。由于本站并没有一个公网 IP，所以支付宝无法访问本站，并返回交易状态，所以通过调用支付宝的订单查询接口，来向支付宝请求查询订单交易状态，完成了一个订单查询的功能。



网站部署时，学习了通过 Nginx + uWSGI 对用户请求的一个调度转发，并且知道了当软件提速达到瓶颈时，往往会在硬件上提速：配置多台业务服务器。而 Nginx 恰好又可以提供一个轮流交付请求给多个业务服务器的功能，实现了「负载均衡」，降低了服务器的压力，也提高了网站的相应速度。



